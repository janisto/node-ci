language: node_js
dist: bionic
sudo: false
node_js:
  - 8
  - 10
  - 12
before_install:
  - export CLOUD_SDK_REPO="cloud-sdk-$(lsb_release -c -s)"
  - echo "deb https://packages.cloud.google.com/apt $CLOUD_SDK_REPO main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
  - curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
  - sudo apt-get update && sudo apt-get install google-cloud-sdk google-cloud-sdk-datastore-emulator google-cloud-sdk-pubsub-emulator
script:
  - cd $TRAVIS_BUILD_DIR && npm ci && npm test
  - cd $TRAVIS_BUILD_DIR/modules/fi.xxx.sample && npm ci && npm test
  - cd $TRAVIS_BUILD_DIR/modules/fi.xxx.test && npm ci && npm test
  - cd $TRAVIS_BUILD_DIR/modules/fi.xxx.datastore && npm ci && npm test
  - cd $TRAVIS_BUILD_DIR/modules/fi.xxx.pubsub && npm ci && npm test
  - cd $TRAVIS_BUILD_DIR && ./node_modules/.bin/prettier --check "**/*.js"
  - cd $TRAVIS_BUILD_DIR && npm run lint
