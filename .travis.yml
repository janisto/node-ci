language: node_js
dist: trusty
sudo: false
node_js:
  - "8"
before_install:
  - npm config set spin false
  - npm i -g npm@6
  - npm -v
  - export CLOUD_SDK_REPO="cloud-sdk-$(lsb_release -c -s)"
  - echo "deb https://packages.cloud.google.com/apt $CLOUD_SDK_REPO main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
  - curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
  - sudo apt-get update && sudo apt-get install google-cloud-sdk google-cloud-sdk-datastore-emulator google-cloud-sdk-pubsub-emulator
cache:
  directories:
    - $HOME/.npm
env:
  - DIR=./
  - DIR=modules/fi.xxx.sample
  - DIR=modules/fi.xxx.test
  - DIR=modules/fi.xxx.datastore
matrix:
  fast_finish: true
script:
  - cd $DIR && npm ci && npm test && npm run lint -- --ignore-pattern modules